'use strict';
angular.module("m-grid",["m-grid.config","m-grid.directive","m-grid.service","m-grid.pagination","m-grid.start-from.filter"]),angular.module("m-grid.config",[]).constant("mGridConfig",{tableClass:"table table-striped table-bordered m-grid-table",thClass:"m-grid-th",footerClass:"m-grid-footer",displayLimitOptions:[{text:10,value:10},{text:20,value:20},{text:50,value:50},{text:100,value:100}]}),angular.module("m-grid.directive",["m-grid.config"]).directive("mGrid",["$log","$compile","$filter","$timeout","mGridConfig","mGridService",function(e,t,i,a,n,r){return{scope:{gridOptions:"="},replace:!0,restrict:"E",template:'<div class="m-grid"></div>',link:function(e,l,o){if(!e.gridOptions)throw new Error("mGrid must configure gridOptions and there columns");var s,g,d=e.gridOptions.globalSearch||n.globalSearch||"globalSearch";if(e.predicate="",e.reverse=!1,e.displayLimitOptions=n.displayLimitOptions,e.startFrom=0,e.currentPage=1,e.displayLimit=10,e.gridOptions.enableSearch){g=e.$on(d,function(e,t){u(t)});var c=e.$watch("gridOptions.search",function(e,t){u(e)})}e.$on("$destroy",function(){e.gridOptions.enableSearch&&(g(),c())}),function(){var i=r.getGridTemplate(e.gridOptions,n);l.html(i),t(l.contents())(e)}(),e.getExternalScope=function(){return e.$parent[e.gridOptions.externalScope||"states"]||{}},e.order=function(t,i){i&&(e.reverse=e.predicate===t&&!e.reverse,e.predicate=t,e.currentPage=1,e.currentPageChange())},e.getRecordCount=function(){var t=e.gridOptions.data||[];return!0===e.gridOptions.enableSearch&&(t=h(t,e.search)),t.length},e.getData=function(){var t=e.gridOptions.data||[];return!0===e.gridOptions.enableSearch&&(t=h(t,e.search)),e.predicate&&(t=m(t,e.predicate,e.reverse)),!0!==e.gridOptions.disablePagination&&(t=p(t,e.startFrom),t=f(t,e.displayLimit)),t},e.currentPageChange=function(){e.startFrom=(e.currentPage-1)*e.displayLimit},e.getStatusString=function(){var t=e.getRecordCount();return e.startFrom+1+" - "+Math.min(e.startFrom+e.displayLimit,t)+" of "+t+" items"},e.recompile=function(i){if(i){var a=r.getGridTemplate(e.gridOptions,n);l.html(a),t(l.contents())(e)}else{var o=l.find("tbody");o.html(r.getBodyTemplate(e.gridOptions,n)),t(o.contents())(e)}};var u=function(t){a.cancel(s),s=a(function(){e.search!==t&&(e.search=t)},500)},m=function(e,t,a){return i("orderBy")(e,t,a)},p=function(e,t){return i("mGridStartFrom")(e,t)},f=function(e,t){return i("limitTo")(e,t)},h=function(e,t){return i("filter")(e,t)};if(e.gridOptions.refresh=e.recompile,e.gridOptions.defaultSorting){var v=e.gridOptions.defaultSorting;0===v.indexOf("-")&&(v=v.substring(1),e.predicate=v),e.order(v,!0)}}}}]),angular.module("m-grid.pagination",["m-grid.config"]).factory("mGridPaging",["$parse",function(e){return{create:function(t,i,a){t.setNumPages=a.numPages?e(a.numPages).assign:angular.noop,t.ngModelCtrl={$setViewValue:angular.noop},t._watchers=[],t.init=function(e,n){t.ngModelCtrl=e,t.config=n,e.$render=function(){t.render()},a.itemsPerPage?t._watchers.push(i.$parent.$watch(a.itemsPerPage,function(e){t.itemsPerPage=parseInt(e,10),i.totalPages=t.calculateTotalPages(),t.updatePage()})):t.itemsPerPage=n.itemsPerPage,i.$watch("totalItems",function(e,a){(angular.isDefined(e)||e!==a)&&(i.totalPages=t.calculateTotalPages(),t.updatePage())})},t.calculateTotalPages=function(){var e=t.itemsPerPage<1?1:Math.ceil(i.totalItems/t.itemsPerPage);return Math.max(e||0,1)},t.render=function(){i.page=parseInt(t.ngModelCtrl.$viewValue,10)||1},i.selectPage=function(e,a){a&&a.preventDefault(),(!i.ngDisabled||!a)&&i.page!==e&&e>0&&e<=i.totalPages&&(a&&a.target&&a.target.blur(),t.ngModelCtrl.$setViewValue(e),t.ngModelCtrl.$render())},i.noPrevious=function(){return 1===i.page},i.noNext=function(){return i.page===i.totalPages},t.updatePage=function(){t.setNumPages(i.$parent,i.totalPages),i.page>i.totalPages?i.selectPage(i.totalPages):t.ngModelCtrl.$render()},i.$on("$destroy",function(){for(;t._watchers.length;)t._watchers.shift()()})}}}]).directive("mGridTabindexToggle",function(){return{restrict:"A",link:function(e,t,i){i.$observe("disabled",function(e){i.$set("tabindex",e?-1:null)})}}}).constant("mGridPaginationConfig",{itemsPerPage:10,maxSize:5}).controller("mGridPaginationController",["$scope","$attrs","$parse","mGridPaging","mGridPaginationConfig",function(e,t,i,a,n){function r(e,t,i){return{number:e,text:t,active:i}}function l(e,t){var i=[],a=1,n=t,l=angular.isDefined(s)&&s<t;l&&(a=(Math.ceil(e/s)-1)*s+1,n=Math.min(a+s-1,t));for(var o=a;o<=n;o++){var d=r(o,g(o),o===e);i.push(d)}if(l&&s>0){if(a>1){var c=r(a-1,"...",!1);i.unshift(c)}if(n<t){var u=r(n+1,"...",!1);i.push(u)}}return i}var o=this,s=angular.isDefined(t.maxSize)?e.$parent.$eval(t.maxSize):n.maxSize,g=angular.identity;t.$set("role","menu"),a.create(this,e,t),t.maxSize&&o._watchers.push(e.$parent.$watch(i(t.maxSize),function(e){s=parseInt(e,10),o.render()}));var d=this.render;this.render=function(){d(),e.page>0&&e.page<=e.totalPages&&(e.pages=l(e.page,e.totalPages))}}]).directive("mGridPagination",["$log","$parse","mGridPaginationConfig",function(e,t,i){return{scope:{totalItems:"=",ngDisabled:"="},require:["mGridPagination","?ngModel"],restrict:"E",replace:!0,controller:"mGridPaginationController",controllerAs:"pagination",template:'<ul class="pagination pagination-sm" style="margin: 0px;"><li role="menuitem" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-first"><a href ng-click="selectPage(1, $event)" ng-disabled="noPrevious()||ngDisabled" m-grid-tabindex-toggle>First</a></li><li role="menuitem" ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}" class="pagination-page"><a href ng-click="selectPage(page.number, $event)" ng-disabled="ngDisabled&&!page.active" m-grid-tabindex-toggle>{{page.text}}</a></li><li role="menuiem" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-last"><a href ng-click="selectPage(totalPages, $event)" ng-disabled="noNext()||ngDisabled" m-grid-tabindex-toggle>Last</a></li></ul>',link:function(e,t,a,n){t.addClass("pagination");var r=n[0],l=n[1];l&&r.init(l,i)}}}]),angular.module("m-grid.service",[]).service("mGridService",["$log",function(e){function t(e){var t="";if(e.style){var i=e.style;t=" ng-style=\"{'text-align':'"+(i.textAlign||"left")+"','display':"+(!1!==i.visible?"'table-cell'":"'none'")+'}"'}var a="<td"+t+">";return e.cellTemplate?a+="<div ng-init=\"row={'entity':item}\">"+e.cellTemplate+"</div>":a+="<span ng-bind=\"item['"+e.field+"']"+(e.format?" | "+e.format:"")+'"></span>',a+="</td>"}function i(e,i){var a="";return a+='<tr ng-repeat="item in getData()">',angular.forEach(e.columns,function(e){a+=t(e)}),a+="</tr>",a+='<tr ng-show="getRecordCount() == 0"><td colspan="'+e.columns.length+'"><div style="text-align:center; margin: 20px auto 20px;"><h3>No record found</h3></div></td></tr>'}function a(e,t){var i="";return i+='<div ng-hide="getRecordCount() == 0" class="panel-footer '+t.footerClass+'">',i+='<m-grid-pagination class="pull-left" style="margin: 0px;" total-items="getRecordCount()" max-size="3" ng-model="currentPage" items-per-page="displayLimit" rotate="false" ng-change="currentPageChange()"></m-grid-pagination>',i+='<div class="pull-left" style=" margin-left: 10px;">',i+='<select class="form-control input-sm hidden-xs" style="display:inline-block; width: 70px; height: 29px;" type="text" ng-model="displayLimit" ng-options="o.value as o.text for o in displayLimitOptions"></select>',i+='<span class="hidden-xs"> items per page</span>',i+='<span ng-if="gridData.loading && !gridData.loadingFull && gridData.firstLoaded" style="display:inline-block; vertical-align: middle; margin-left: 10px; height:22px;">',i+='<progress-circular size="sm"></progress-circular>',i+="</span>",i+="</div>",i+='<div class="pull-right hidden-xs" ng-bind="getStatusString()" style="margin-top:5px;"></div>',i+='<div class="clearfix"></div>',i+="</div>"}return{getGridTemplate:function(e,t){var n="";return n+='<div style="overflow-x:auto;width: 100%;">',n+='<table class="'+t.tableClass+'">',n+="<thead>",n+="<tr>",n+='<th ng-repeat="column in gridOptions.columns" class="'+t.thClass+"\" ng-style=\"{'width':column.style.width||'auto','min-width':column.style.minWidth||'auto','text-align':column.style.textAlign||'left','display':(column.style.visible!==false?'table-cell':'none')}\">",n+='<a href="" ng-click="order(column.field, (column.sorting !== undefined ? column.sorting : gridOptions.sorting))" ng-bind="column.name">Name</a>',n+='<span class="m-grid-sortorder" ng-show="predicate === column.field" ng-class="{\'m-grid-sortorder-reverse\':reverse}"></span>',n+="</th>",n+="</tr>",n+="</thead>",n+="<tbody>",n+=i(e),n+="</tbody>",n+="</thead>",n+="</table>",!0!==e.disablePagination&&(n+=a(0,t)),n+="</div>"},getCellTemplate:t,getBodyTemplate:i,getPaginationTemplate:a}}]),angular.module("m-grid.start-from.filter",[]).filter("mGridStartFrom",function(){return function(e,t){return angular.isArray(e)?(t=+t,e.slice(t)):e}});