'use strict';
angular.module("m-grid",["m-grid.config","m-grid.directive","m-grid.service","m-grid.pagination","m-grid.start-from.filter","m-grid.progress-circular.direcitve"]),angular.module("m-grid.config",[]).provider("mGridConfig",function(){var t={tableClass:"table table-striped table-bordered m-grid-table",thClass:"m-grid-th",footerClass:"m-grid-footer",defaultPageLimit:10,displayLimitOptions:[{text:10,value:10},{text:20,value:20},{text:50,value:50},{text:100,value:100}]};this.setDefaultPageLimit=function(a){t.defaultPageLimit=a||10},this.setDisplayLimitOptions=function(a){if(!angular.isArray(a))throw new Error("param limitOptions should be array");if(0===a.length)throw new Error("param limitOptions should have at least one record");t.displayLimitOptions=[],a.forEach(function(a){angular.isObject(a)?t.displayLimitOptions.push({text:a.text,value:a.value}):t.displayLimitOptions.push({text:a,value:+a})})},this.setCssClass=function(a){if(!angular.isObject(a))throw new Error("param classObj should be a object");a.hasOwnProperty("table")&&(t.tableClass=a.table),a.hasOwnProperty("th")&&(t.thClass=a.th),a.hasOwnProperty("footer")&&(t.footerClass=a.footer)},this.appendCssClass=function(a){if(!angular.isObject(a))throw new Error("param classObj should be a object");a.hasOwnProperty("table")&&(t.tableClass+=" "+a.table),a.hasOwnProperty("th")&&(t.thClass+=" "+a.th),a.hasOwnProperty("footer")&&(t.footerClass+=" "+a.footer)},this.$get=[function(){return t}]}),angular.module("m-grid.directive",["m-grid.config"]).directive("mGrid",["$log","$compile","$filter","$timeout","$http","$q","mGridConfig","mGridService",function(t,a,e,i,n,r,o,s){return{scope:{gridOptions:"="},replace:!0,restrict:"E",template:'<div class="m-grid"></div>',link:function(l,g,d){if(!l.gridOptions)throw new Error("mGrid must configure gridOptions and there columns");var c,u,p,m=l.gridOptions.globalSearch||o.globalSearch||"globalSearch",f=!1,h=10;if(l.predicate="",l.reverse=!1,l.displayLimitOptions=o.displayLimitOptions,l.startFrom=0,l.currentPage=1,l.displayLimit=(l.gridOptions.config||{}).defaultPageLimit||o.defaultPageLimit,l.gridData={data:[],total:0,loading:!1,loadingFull:!1,firstLoaded:!1},l.gridOptions.enableSearch){u=l.$on(m,function(t,a){P(a)});var v=l.$watch("gridOptions.search",function(t,a){P(t)})}var y=l.$watch("displayLimit",function(){l.gridData.loadingFull=!1,f&&h!==l.displayLimit&&(h=l.displayLimit,w())});l.$on("$destroy",function(){l.gridOptions.enableSearch&&(u(),v()),y()}),function(){var t=s.getGridTemplate(l.gridOptions,o);g.html(t),a(g.contents())(l)}(),l.getExternalScope=function(){return l.$parent[l.gridOptions.externalScope||"states"]||{}},l.order=function(t,a){a&&(l.reverse=l.predicate===t&&!l.reverse,l.predicate=t,l.currentPage=1,l.currentPageChange())},l.getRecordCount=function(){if(l.gridOptions.async)return l.gridData.total||0;var t=l.gridOptions.data||[];return!0===l.gridOptions.enableSearch&&(t=x(t,l.search)),t.length},l.getData=function(){if(l.gridOptions.async)return l.gridData.data||[];var t=l.gridOptions.data||[];return!0===l.gridOptions.enableSearch&&(t=x(t,l.search)),l.predicate&&(t=b(t,l.predicate,l.reverse)),!0!==l.gridOptions.disablePagination&&(t=D(t,l.startFrom),t=O(t,l.displayLimit)),t},l.currentPageChange=function(){if(l.startFrom=(l.currentPage-1)*l.displayLimit,f&&l.gridOptions.async){l.gridData.loadingFull=!1,l.gridData.loading=!0;var a=$();l.asyncData(a).then(function(t){l.gridData.data=l.gridOptions.data=t,l.gridData.loading=!1,l.gridData.firstLoaded=!0,L()},function(a){l.gridData.loading=!1,l.gridData.firstLoaded=!0,t.error(a)})}},l.getStatusString=function(){var t=l.getRecordCount();return l.startFrom+1+" - "+Math.min(l.startFrom+l.displayLimit,t)+" of "+t+" items"},l.recompile=function(t){if(t){var e=s.getGridTemplate(l.gridOptions,o);g.html(e),a(g.contents())(l)}else{var i=g.find("tbody");i.html(s.getBodyTemplate(l.gridOptions,o)),a(i.contents())(l)}};var P=function(t){i.cancel(c),c=i(function(){l.search!==t&&(l.search=t,l.gridOptions.async&&w())},1e3)},b=function(t,a,i){return e("orderBy")(t,a,i)},D=function(t,a){return e("mGridStartFrom")(t,a)},O=function(t,a){return e("limitTo")(t,a)},x=function(t,a){return e("filter")(t,a)},C=function(t){return function(a){var e=t;return angular.forEach(a,function(t,a){angular.isUndefined(t)&&(t=""),e=e.replace("{"+a+"}",t)}),n.get(e).then(function(t){return t.data}).catch(function(t){return r.reject(t.data)})}},$=function(){var t="";l.predicate&&(t=(l.reverse?"-":"")+l.predicate);var a={};if(l.gridOptions.urlParams&&angular.isObject(l.gridOptions.urlParams))for(var e in l.gridOptions.urlParams)a[e]=l.gridOptions.urlParams[e];return angular.extend(a,{term:l.search,orderby:t,skip:l.startFrom,take:l.displayLimit,page:l.currentPage,limit:l.displayLimit}),a},w=function(){l.currentPage=1;var a=$();l.gridData.loading=!0,l.gridData.loadingFull=!0,l.asyncDataCount(a).then(function(e){l.gridData.total=e,L(),l.asyncData(a).then(function(t){l.gridData.data=l.gridOptions.data=t,l.gridData.loading=!1,l.gridData.firstLoaded=!0,l.gridData.loadingFull=!1,L()},function(a){l.gridData.loading=!1,l.gridData.firstLoaded=!0,l.gridData.loadingFull=!1,t.error(a)})},function(a){l.gridData.loading=!1,l.gridData.loadingFull=!1,t.error(a)})},L=function(){void 0===p&&(p=i(function(){p=void 0,l.$$phase?L():l.$apply()},500))};if(l.gridOptions.refresh=l.recompile,l.gridOptions.defaultSorting){var S=l.gridOptions.defaultSorting;0===S.indexOf("-")&&(S=S.substring(1),l.predicate=S),l.order(S,!0)}l.gridOptions.async&&(function(){if("function"!=typeof l.gridOptions.asyncData&&"string"!=typeof l.gridOptions.asyncData||"function"!=typeof l.gridOptions.asyncDataCount&&"string"!=typeof l.gridOptions.asyncDataCount)throw new Error("asyncData and asyncCount must a function or string");"function"==typeof l.gridOptions.asyncData?l.asyncData=l.gridOptions.asyncData:l.asyncData=C(l.gridOptions.asyncData),"function"==typeof l.gridOptions.asyncDataCount?l.asyncDataCount=l.gridOptions.asyncDataCount:l.asyncDataCount=C(l.gridOptions.asyncDataCount)}(),w()),f=!0}}}]),angular.module("m-grid.pagination",["m-grid.config"]).factory("mGridPaging",["$parse",function(t){return{create:function(a,e,i){a.setNumPages=i.numPages?t(i.numPages).assign:angular.noop,a.ngModelCtrl={$setViewValue:angular.noop},a._watchers=[],a.init=function(t,n){a.ngModelCtrl=t,a.config=n,t.$render=function(){a.render()},i.itemsPerPage?a._watchers.push(e.$parent.$watch(i.itemsPerPage,function(t){a.itemsPerPage=parseInt(t,10),e.totalPages=a.calculateTotalPages(),a.updatePage()})):a.itemsPerPage=n.itemsPerPage,e.$watch("totalItems",function(t,i){(angular.isDefined(t)||t!==i)&&(e.totalPages=a.calculateTotalPages(),a.updatePage())})},a.calculateTotalPages=function(){var t=a.itemsPerPage<1?1:Math.ceil(e.totalItems/a.itemsPerPage);return Math.max(t||0,1)},a.render=function(){e.page=parseInt(a.ngModelCtrl.$viewValue,10)||1},e.selectPage=function(t,i){i&&i.preventDefault(),(!e.ngDisabled||!i)&&e.page!==t&&t>0&&t<=e.totalPages&&(i&&i.target&&i.target.blur(),a.ngModelCtrl.$setViewValue(t),a.ngModelCtrl.$render())},e.noPrevious=function(){return 1===e.page},e.noNext=function(){return e.page===e.totalPages},a.updatePage=function(){a.setNumPages(e.$parent,e.totalPages),e.page>e.totalPages?e.selectPage(e.totalPages):a.ngModelCtrl.$render()},e.$on("$destroy",function(){for(;a._watchers.length;)a._watchers.shift()()})}}}]).directive("mGridTabindexToggle",function(){return{restrict:"A",link:function(t,a,e){e.$observe("disabled",function(t){e.$set("tabindex",t?-1:null)})}}}).constant("mGridPaginationConfig",{itemsPerPage:10,maxSize:5}).controller("mGridPaginationController",["$scope","$attrs","$parse","mGridPaging","mGridPaginationConfig",function(t,a,e,i,n){function r(t,a,e){return{number:t,text:a,active:e}}function o(t,a){var e=[],i=1,n=a,o=angular.isDefined(l)&&l<a;o&&(i=(Math.ceil(t/l)-1)*l+1,n=Math.min(i+l-1,a));for(var s=i;s<=n;s++){var d=r(s,g(s),s===t);e.push(d)}if(o&&l>0){if(i>1){var c=r(i-1,"...",!1);e.unshift(c)}if(n<a){var u=r(n+1,"...",!1);e.push(u)}}return e}var s=this,l=angular.isDefined(a.maxSize)?t.$parent.$eval(a.maxSize):n.maxSize,g=angular.identity;a.$set("role","menu"),i.create(this,t,a),a.maxSize&&s._watchers.push(t.$parent.$watch(e(a.maxSize),function(t){l=parseInt(t,10),s.render()}));var d=this.render;this.render=function(){d(),t.page>0&&t.page<=t.totalPages&&(t.pages=o(t.page,t.totalPages))}}]).directive("mGridPagination",["$log","$parse","mGridPaginationConfig",function(t,a,e){return{scope:{totalItems:"=",ngDisabled:"="},require:["mGridPagination","?ngModel"],restrict:"E",replace:!0,controller:"mGridPaginationController",controllerAs:"pagination",template:'<ul class="pagination pagination-sm" style="margin: 0px;"><li role="menuitem" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-first"><a href ng-click="selectPage(1, $event)" ng-disabled="noPrevious()||ngDisabled" m-grid-tabindex-toggle>First</a></li><li role="menuitem" ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}" class="pagination-page"><a href ng-click="selectPage(page.number, $event)" ng-disabled="ngDisabled&&!page.active" m-grid-tabindex-toggle>{{page.text}}</a></li><li role="menuiem" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-last"><a href ng-click="selectPage(totalPages, $event)" ng-disabled="noNext()||ngDisabled" m-grid-tabindex-toggle>Last</a></li></ul>',link:function(t,a,i,n){a.addClass("pagination");var r=n[0],o=n[1];o&&r.init(o,e)}}}]),angular.module("m-grid.service",[]).service("mGridService",["$log",function(t){function a(t,a){var e="";if(t.style){var i=t.style;e=" ng-style=\"{'text-align':'"+(i.textAlign||"left")+"','display':"+(!1!==i.visible?"'table-cell'":"'none'")+'}"'}var n="<td"+e+">";return t.cellTemplate?n+=a?'<div ng-init="'+a+'=item">'+t.cellTemplate+"</div>":"<div>"+t.cellTemplate+"</div>":n+="<span ng-bind=\"item['"+t.field+"']"+(t.format?" | "+t.format:"")+'"></span>',n+="</td>"}function e(t,e){var i="";return i+='<tr ng-repeat="item in getData()">',angular.forEach(t.columns,function(e){i+=a(e,t.rowItemAlias)}),i+="</tr>",i+='<tr ng-show="getRecordCount() == 0 && (!gridOptions.async || gridData.firstLoaded)"><td colspan="'+t.columns.length+'"><div style="text-align:center; margin: 20px auto 20px;"><h3>No record found</h3></div></td></tr>'}function i(t,a){var e="";return e+='<div ng-hide="getRecordCount() == 0 || (gridData.loading && gridData.loadingFull)" class="panel-footer '+a.footerClass+'">',e+='<m-grid-pagination class="pull-left" style="margin: 0px;" total-items="getRecordCount()" max-size="3" ng-model="currentPage" items-per-page="displayLimit" rotate="false" ng-change="currentPageChange()"></m-grid-pagination>',e+='<div class="pull-left" style=" margin-left: 10px;">',e+='<select class="form-control input-sm hidden-xs" style="display:inline-block; width: 70px; height: 29px;" type="text" ng-model="displayLimit" ng-options="o.value as o.text for o in displayLimitOptions"></select>',e+='<span class="hidden-xs"> items per page</span>',e+='<span ng-if="gridData.loading && !gridData.loadingFull && gridData.firstLoaded" style="display:inline-block; vertical-align: middle; margin-left: 10px; height:22px;">',e+='<progress-circular size="sm"></progress-circular>',e+="</span>",e+="</div>",e+='<div class="pull-right hidden-xs" ng-bind="getStatusString()" style="margin-top:5px;"></div>',e+='<div class="clearfix"></div>',e+="</div>"}return{getGridTemplate:function(t,a){var n="";return n+='<div style="overflow-x:auto;width: 100%;">',n+='<table class="'+a.tableClass+'">',n+="<thead>",n+="<tr>",n+='<th ng-repeat="column in gridOptions.columns" class="'+a.thClass+"\" ng-style=\"{'width':column.style.width||'auto','min-width':column.style.minWidth||'auto','text-align':column.style.textAlign||'left','display':(column.style.visible!==false?'table-cell':'none')}\">",n+='<a href="" ng-click="order(column.field, (column.sorting !== undefined ? column.sorting : gridOptions.sorting))" ng-bind="column.name">Name</a>',n+='<span class="m-grid-sortorder" ng-show="predicate === column.field" ng-class="{\'m-grid-sortorder-reverse\':reverse}"></span>',n+="</th>",n+="</tr>",n+="</thead>",n+='<tbody ng-hide="gridData.loading && gridData.loadingFull">',n+=e(t),n+="</tbody>",n+="<tbody>",n+='<tr ng-show="gridOptions.async && ((gridData.loading && gridData.loadingFull) || !gridData.firstLoaded)"><td colspan="'+t.columns.length+'" style="text-align:center; margin: 20px auto 10px;"><progress-circular></progress-circular></td></tr>',n+="</tbody>",n+="</table>",!0!==t.disablePagination&&(n+=i(0,a)),n+="</div>"},getCellTemplate:a,getBodyTemplate:e,getPaginationTemplate:i}}]),angular.module("m-grid.start-from.filter",[]).filter("mGridStartFrom",function(){return function(t,a){return angular.isArray(t)?(a=+a,t.slice(a)):t}});