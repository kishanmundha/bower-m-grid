'use strict';
angular.module("m-grid",["m-grid.config","m-grid.directive","m-grid.service","m-grid.pagination","m-grid.start-from.filter","m-grid.progress-circular.direcitve"]),angular.module("m-grid.config",[]).provider("mGridConfig",function(){var t={tableClass:"table table-striped table-bordered m-grid-table",thClass:"m-grid-th",footerClass:"m-grid-footer",defaultPageLimit:10,displayLimitOptions:[{text:10,value:10},{text:20,value:20},{text:50,value:50},{text:100,value:100}]};this.setDefaultPageLimit=function(a){t.defaultPageLimit=a||10},this.setDisplayLimitOptions=function(a){if(!angular.isArray(a))throw new Error("param limitOptions should be array");if(0===a.length)throw new Error("param limitOptions should have at least one record");t.displayLimitOptions=[],a.forEach(function(a){angular.isObject(a)?t.displayLimitOptions.push({text:a.text,value:a.value}):t.displayLimitOptions.push({text:a,value:+a})})},this.setCssClass=function(a){if(!angular.isObject(a))throw new Error("param classObj should be a object");a.hasOwnProperty("table")&&(t.tableClass=a.table),a.hasOwnProperty("th")&&(t.thClass=a.th),a.hasOwnProperty("footer")&&(t.footerClass=a.footer)},this.appendCssClass=function(a){if(!angular.isObject(a))throw new Error("param classObj should be a object");a.hasOwnProperty("table")&&(t.tableClass+=" "+a.table),a.hasOwnProperty("th")&&(t.thClass+=" "+a.th),a.hasOwnProperty("footer")&&(t.footerClass+=" "+a.footer)},this.$get=[function(){return t}]}),angular.module("m-grid.directive",["m-grid.config"]).directive("mGrid",["$log","$compile","$filter","$timeout","$http","$q","mGridConfig","mGridService",function(t,a,i,e,r,n,o,s){return{scope:{gridOptions:"="},replace:!0,restrict:"E",template:'<div class="m-grid"></div>',link:function(l,g,d){if(!l.gridOptions)throw new Error("mGrid must configure gridOptions and there columns");var c,u,p,m,f,h=l.gridOptions.globalSearch||o.globalSearch||"globalSearch",v=!1,y=(l.gridOptions.config||{}).defaultPageLimit||o.defaultPageLimit,P=l.gridOptions.urlParams;l.predicate="",l.reverse=!1,l.displayLimitOptions=o.displayLimitOptions,l.startFrom=0,l.currentPage=1,l.displayLimit=(l.gridOptions.config||{}).defaultPageLimit||o.defaultPageLimit,l.gridData={data:[],total:0,loading:!1,loadingFull:!1,firstLoaded:!1},l.gridOptions.enableSearch&&(u=l.$on(h,function(t,a){b(a)}),p=l.$watch("gridOptions.search",function(t,a){b(t)})),l.gridOptions.urlParams&&(P=JSON.stringify(l.gridOptions.urlParams),m=l.$watchCollection("gridOptions.urlParams",function(t,a){v&&P!==JSON.stringify(l.gridOptions.urlParams)&&(P=JSON.stringify(l.gridOptions.urlParams),l.gridOptions.async&&S())}));var O=l.$watch("displayLimit",function(){l.gridData.loadingFull=!1,v&&y!==l.displayLimit&&(y=l.displayLimit,l.gridOptions.async&&S())});l.$on("$destroy",function(){l.gridOptions.enableSearch&&(u(),p()),O(),m&&m()}),function(){var t=s.getGridTemplate(l.gridOptions,o);g.html(t),a(g.contents())(l)}(),l.getExternalScope=function(){return l.$parent[l.gridOptions.externalScope||"states"]||{}},l.order=function(t,a){a&&(l.reverse=l.predicate===t&&!l.reverse,l.predicate=t,l.currentPage=1,l.currentPageChange())},l.getRecordCount=function(){if(l.gridOptions.async)return l.gridData.total||0;var t=l.gridOptions.data||[];return!0===l.gridOptions.enableSearch&&(t=$(t,l.search)),t.length},l.getData=function(){if(l.gridOptions.async)return l.gridData.data||[];var t=l.gridOptions.data||[];return!0===l.gridOptions.enableSearch&&(t=$(t,l.search)),l.predicate&&(t=D(t,l.predicate,l.reverse)),!0!==l.gridOptions.disablePagination&&(t=x(t,l.startFrom),t=C(t,l.displayLimit)),t},l.currentPageChange=function(){if(l.startFrom=(l.currentPage-1)*l.displayLimit,v&&l.gridOptions.async){l.gridData.loadingFull=!1,l.gridData.loading=!0;var a=L();l.asyncData(a).then(function(t){l.gridData.data=l.gridOptions.data=t,l.gridData.loading=!1,l.gridData.firstLoaded=!0,F()},function(a){l.gridData.loading=!1,l.gridData.firstLoaded=!0,t.error(a)})}},l.getStatusString=function(){var t=l.getRecordCount();return l.startFrom+1+" - "+Math.min(l.startFrom+l.displayLimit,t)+" of "+t+" items"},l.recompile=function(t){if(t){var i=s.getGridTemplate(l.gridOptions,o);g.html(i),a(g.contents())(l)}else{var e=g.find("tbody");e.html(s.getBodyTemplate(l.gridOptions,o)),a(e.contents())(l)}};var b=function(t){e.cancel(c),c=e(function(){l.search!==t&&(l.startFrom=0,l.currentPage=1,l.search=t,l.gridOptions.async&&S())},1e3)},D=function(t,a,e){return i("orderBy")(t,a,e)},x=function(t,a){return i("mGridStartFrom")(t,a)},C=function(t,a){return i("limitTo")(t,a)},$=function(t,a){return i("filter")(t,a)},w=function(t){return function(a){var i=t;return angular.forEach(a,function(t,a){angular.isUndefined(t)&&(t=""),i=i.replace("{"+a+"}",t)}),r.get(i).then(function(t){return t.data}).catch(function(t){return n.reject(t.data)})}},L=function(){var t="",a="",i="";l.predicate&&(t=(l.reverse?"-":"")+l.predicate,a=l.predicate,i=l.reverse?"desc":"asc");var e={};if(l.gridOptions.urlParams&&angular.isObject(l.gridOptions.urlParams))for(var r in l.gridOptions.urlParams)e[r]=l.gridOptions.urlParams[r];return angular.extend(e,{term:l.search,orderby:t,sortby:a,sortorder:i,skip:l.startFrom,take:l.displayLimit,page:l.currentPage,limit:l.displayLimit}),e},S=function(){l.startFrom=0,l.currentPage=1;var a=L();l.gridData.loading=!0,l.gridData.loadingFull=!0,l.asyncDataCount(a).then(function(i){l.gridData.total=i,F(),l.asyncData(a).then(function(t){l.gridData.data=l.gridOptions.data=t,l.gridData.loading=!1,l.gridData.firstLoaded=!0,l.gridData.loadingFull=!1,F()},function(a){l.gridData.loading=!1,l.gridData.firstLoaded=!0,l.gridData.loadingFull=!1,t.error(a)})},function(a){l.gridData.loading=!1,l.gridData.loadingFull=!1,t.error(a)})},F=function(){void 0===f&&(f=e(function(){f=void 0,l.$$phase?F():l.$apply()},500))};if(l.gridOptions.refresh=l.recompile,l.gridOptions.defaultSorting){var G=l.gridOptions.defaultSorting;0===G.indexOf("-")&&(G=G.substring(1),l.predicate=G),l.order(G,!0)}l.gridOptions.async&&(function(){if("function"!=typeof l.gridOptions.asyncData&&"string"!=typeof l.gridOptions.asyncData||"function"!=typeof l.gridOptions.asyncDataCount&&"string"!=typeof l.gridOptions.asyncDataCount)throw new Error("asyncData and asyncCount must a function or string");"function"==typeof l.gridOptions.asyncData?l.asyncData=l.gridOptions.asyncData:l.asyncData=w(l.gridOptions.asyncData),"function"==typeof l.gridOptions.asyncDataCount?l.asyncDataCount=l.gridOptions.asyncDataCount:l.asyncDataCount=w(l.gridOptions.asyncDataCount)}(),S()),v=!0}}}]),angular.module("m-grid.pagination",["m-grid.config"]).factory("mGridPaging",["$parse",function(t){return{create:function(a,i,e){a.setNumPages=e.numPages?t(e.numPages).assign:angular.noop,a.ngModelCtrl={$setViewValue:angular.noop},a._watchers=[],a.init=function(t,r){a.ngModelCtrl=t,a.config=r,t.$render=function(){a.render()},e.itemsPerPage?a._watchers.push(i.$parent.$watch(e.itemsPerPage,function(t){a.itemsPerPage=parseInt(t,10),i.totalPages=a.calculateTotalPages(),a.updatePage()})):a.itemsPerPage=r.itemsPerPage,i.$watch("totalItems",function(t,e){(angular.isDefined(t)||t!==e)&&(i.totalPages=a.calculateTotalPages(),a.updatePage())})},a.calculateTotalPages=function(){var t=a.itemsPerPage<1?1:Math.ceil(i.totalItems/a.itemsPerPage);return Math.max(t||0,1)},a.render=function(){i.page=parseInt(a.ngModelCtrl.$viewValue,10)||1},i.selectPage=function(t,e){e&&e.preventDefault(),(!i.ngDisabled||!e)&&i.page!==t&&t>0&&t<=i.totalPages&&(e&&e.target&&e.target.blur(),a.ngModelCtrl.$setViewValue(t),a.ngModelCtrl.$render())},i.noPrevious=function(){return 1===i.page},i.noNext=function(){return i.page===i.totalPages},a.updatePage=function(){a.setNumPages(i.$parent,i.totalPages),i.page>i.totalPages?i.selectPage(i.totalPages):a.ngModelCtrl.$render()},i.$on("$destroy",function(){for(;a._watchers.length;)a._watchers.shift()()})}}}]).directive("mGridTabindexToggle",function(){return{restrict:"A",link:function(t,a,i){i.$observe("disabled",function(t){i.$set("tabindex",t?-1:null)})}}}).constant("mGridPaginationConfig",{itemsPerPage:10,maxSize:5}).controller("mGridPaginationController",["$scope","$attrs","$parse","mGridPaging","mGridPaginationConfig",function(t,a,i,e,r){function n(t,a,i){return{number:t,text:a,active:i}}function o(t,a){var i=[],e=1,r=a,o=angular.isDefined(l)&&l<a;o&&(e=(Math.ceil(t/l)-1)*l+1,r=Math.min(e+l-1,a));for(var s=e;s<=r;s++){var d=n(s,g(s),s===t);i.push(d)}if(o&&l>0){if(e>1){var c=n(e-1,"...",!1);i.unshift(c)}if(r<a){var u=n(r+1,"...",!1);i.push(u)}}return i}var s=this,l=angular.isDefined(a.maxSize)?t.$parent.$eval(a.maxSize):r.maxSize,g=angular.identity;a.$set("role","menu"),e.create(this,t,a),a.maxSize&&s._watchers.push(t.$parent.$watch(i(a.maxSize),function(t){l=parseInt(t,10),s.render()}));var d=this.render;this.render=function(){d(),t.page>0&&t.page<=t.totalPages&&(t.pages=o(t.page,t.totalPages))}}]).directive("mGridPagination",["$log","$parse","mGridPaginationConfig",function(t,a,i){return{scope:{totalItems:"=",ngDisabled:"="},require:["mGridPagination","?ngModel"],restrict:"E",replace:!0,controller:"mGridPaginationController",controllerAs:"pagination",template:'<ul class="pagination pagination-sm" style="margin: 0px;"><li role="menuitem" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-first"><a href ng-click="selectPage(1, $event)" ng-disabled="noPrevious()||ngDisabled" m-grid-tabindex-toggle>First</a></li><li role="menuitem" ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}" class="pagination-page"><a href ng-click="selectPage(page.number, $event)" ng-disabled="ngDisabled&&!page.active" m-grid-tabindex-toggle>{{page.text}}</a></li><li role="menuiem" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-last"><a href ng-click="selectPage(totalPages, $event)" ng-disabled="noNext()||ngDisabled" m-grid-tabindex-toggle>Last</a></li></ul>',link:function(t,a,e,r){a.addClass("pagination");var n=r[0],o=r[1];o&&n.init(o,i)}}}]),angular.module("m-grid.service",[]).service("mGridService",["$log",function(t){function a(t,a){var i="";if(t.style){var e=t.style;i=" ng-style=\"{'text-align':'"+(e.textAlign||"left")+"','display':"+(!1!==e.visible?"'table-cell'":"'none'")+'}"'}var r="<td"+i+">";return t.cellTemplate?r+=a?'<div ng-init="'+a+'=item">'+t.cellTemplate+"</div>":"<div>"+t.cellTemplate+"</div>":r+="<span ng-bind=\"item['"+t.field+"']"+(t.format?" | "+t.format:"")+'"></span>',r+="</td>"}function i(t,i){var e="";return e+='<tr ng-repeat="item in getData()">',angular.forEach(t.columns,function(i){e+=a(i,t.rowItemAlias)}),e+="</tr>",e+='<tr ng-show="getRecordCount() == 0 && (!gridOptions.async || gridData.firstLoaded)"><td colspan="'+t.columns.length+'"><div style="text-align:center; margin: 20px auto 20px;"><h3>No record found</h3></div></td></tr>'}function e(t,a){var i="";return i+='<div ng-hide="getRecordCount() == 0 || (gridData.loading && gridData.loadingFull)" class="panel-footer '+a.footerClass+'">',i+='<m-grid-pagination class="pull-left" style="margin: 0px;" total-items="getRecordCount()" max-size="3" ng-model="currentPage" items-per-page="displayLimit" rotate="false" ng-change="currentPageChange()"></m-grid-pagination>',i+='<div class="pull-left" style=" margin-left: 10px;">',i+='<select class="form-control input-sm hidden-xs" style="display:inline-block; width: 70px; height: 29px;" type="text" ng-model="displayLimit" ng-options="o.value as o.text for o in displayLimitOptions"></select>',i+='<span class="hidden-xs"> items per page</span>',i+='<span ng-if="gridData.loading && !gridData.loadingFull && gridData.firstLoaded" style="display:inline-block; vertical-align: middle; margin-left: 10px; height:22px;">',i+='<progress-circular size="sm"></progress-circular>',i+="</span>",i+="</div>",i+='<div class="pull-right hidden-xs" ng-bind="getStatusString()" style="margin-top:5px;"></div>',i+='<div class="clearfix"></div>',i+="</div>"}return{getGridTemplate:function(t,a){var r="";return r+='<div style="overflow-x:auto;width: 100%;">',r+='<table class="'+a.tableClass+'">',r+="<thead>",r+="<tr>",r+='<th ng-repeat="column in gridOptions.columns" class="'+a.thClass+"\" ng-style=\"{'width':column.style.width||'auto','min-width':column.style.minWidth||'auto','text-align':column.style.textAlign||'left','display':(column.style.visible!==false?'table-cell':'none')}\">",r+='<a href="" ng-click="order(column.field, (column.sorting !== undefined ? column.sorting : gridOptions.sorting))" ng-bind="column.name">Name</a>',r+='<span class="m-grid-sortorder" ng-show="predicate === column.field" ng-class="{\'m-grid-sortorder-reverse\':reverse}"></span>',r+="</th>",r+="</tr>",r+="</thead>",r+='<tbody ng-hide="gridData.loading && gridData.loadingFull">',r+=i(t),r+="</tbody>",r+="<tbody>",r+='<tr ng-show="gridOptions.async && ((gridData.loading && gridData.loadingFull) || !gridData.firstLoaded)"><td colspan="'+t.columns.length+'" style="text-align:center; margin: 20px auto 10px;"><progress-circular></progress-circular></td></tr>',r+="</tbody>",r+="</table>",!0!==t.disablePagination&&(r+=e(0,a)),r+="</div>"},getCellTemplate:a,getBodyTemplate:i,getPaginationTemplate:e}}]),angular.module("m-grid.start-from.filter",[]).filter("mGridStartFrom",function(){return function(t,a){return angular.isArray(t)?(a=+a,t.slice(a)):t}}),angular.module("m-grid.progress-circular.direcitve",[]).directive("progressCircular",["$compile",function(t){return{restrict:"EA",scope:{size:"@"},replace:!0,template:"<span></span>",link:function(a,i){var e=50,r=50,n=20,o="m-grid-progress-dash",s=3,l=100,g=100;"sm"===a.size&&(e=11,r=11,n=10,o="m-grid-progress-dash-sm",l=22,g=22,s=2);var d='<svg style="animation: m-grid-progress-rotate 2s linear infinite; height: '+g+"px; width: "+l+'px; position: relative"><circle style="animation:'+o+' 1.5s ease-in-out infinite, m-grid-progress-color 6s ease-in-out infinite" cx="'+e+'" cy="'+r+'" r="'+n+'" stroke-dasharray="1,200" stroke-dashoffset="0" stroke-linecap="round" fill="none" stroke-width="'+s+'" stroke-miterlimit="10"/></svg>';i.html(d);var c=t(d)(a);i.replaceWith(c)}}}]);